---
layout: default
---

{% assign brand_page = site.brands | where: 'brand_slug', page.brand_slug | first %}
{% if brand_page and brand_page.logo_path %}
  {% assign logo_path = brand_page.logo_path %}
{% else %}
  {% assign logo_path = '/media/brand_logos/' | append: page.brand_slug | append: '.jpg' %}
{% endif %}
{% if brand_page and brand_page.title %}
  {% assign brand_name = brand_page.title | replace: ' discount codes', '' | replace: ' promo codes', '' | strip %}
{% else %}
  {% assign brand_name = page.brand_slug | replace: '-', ' ' | capitalize %}
{% endif %}
<article class="space-y-5 max-w-2xl w-full">
  <header class="liquid-glass rounded-3xl p-4">
    <div class="flex items-center gap-3">
      <div class="w-14 h-14 shrink-0 aspect-square rounded-xl border border-slate-200 overflow-hidden bg-white/80">
        <img src="{{ logo_path | relative_url }}" alt="{{ brand_name }} logo" class="w-full h-full object-cover" loading="lazy">
      </div>
      <div>
        <p class="text-xs uppercase tracking-[0.2em] text-slate-500">{{ brand_name }} Â· discounts</p>
        <h1 class="text-xl font-semibold tracking-tight">{{ page.title }}</h1>
      </div>
    </div>
  </header>

  {% if page.code %}
    <section class="rounded-2xl bg-slate-900 text-slate-50 p-4">
      <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400">Promo code</p>
      <div class="mt-2 flex flex-col sm:flex-row gap-3">
        <div class="flex-1 rounded-xl border border-slate-700 px-3 py-2">
          <span class="font-mono text-lg code-fluid-blur select-none" data-code-display aria-label="Hidden promo code">{{ page.code }}</span>
        </div>
        <button type="button" data-copy-code-button data-copy-code="{{ page.code }}" data-brand-slug="{{ page.brand_slug }}" data-url-external="{{ page.url_external }}" class="rounded-xl border border-slate-700 bg-slate-800 px-4 py-2 text-sm font-semibold">View Code</button>
      </div>
      <p id="copy-message" class="text-xs text-emerald-300 opacity-0 transition-opacity mt-2">Code revealed. Partner page opened in new tab.</p>
    </section>
  {% endif %}

  <p class="text-[11px] text-rose-500" role="button" tabindex="0" data-report-invalid data-coupon-id="{{ page.url | relative_url }}">Report invalid code</p>

  {% if page.code %}
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const button = document.querySelector('[data-copy-code-button]');
        const display = document.querySelector('[data-code-display]');
        const status = document.getElementById('copy-message');
        const couponId = {{ page.url | relative_url | jsonify }};
        const xpStorageKey = 'spendless-xp-unlocked-coupons';
        if (!button || !display) return;

        const code = button.dataset.copyCode;
        const brand = button.dataset.brandSlug;
        const explicitExternal = button.dataset.urlExternal;
        const offerHosts = {
          '1800contacts': 'https://spendlesscontacts.wiki/', 'aliexpress': 'https://myaliexpress.wiki/',
          'autonationparts': 'https://autonationparts.wiki/', 'booking': 'https://spendlessbooking.wiki/',
          'expedia': 'https://expediasavers.wiki/', 'hotelscom': 'https://hotelsdiscounts.wiki/', 'lulus': 'https://luluscheaper.wiki/',
          'lumens': 'https://mylumens.wiki/', 'nike': 'https://spendlessnike.wiki/', 'petco': 'https://petcocoupon.wiki/',
          'shein': 'https://sheincoupons.wiki/', 'temu': 'https://temucoupon.pro/', 'walmart': 'https://walmartcodes.wiki/'
        };

        display.textContent = code;

        const openOffer = () => {
          const fallback = offerHosts[brand] ? `${offerHosts[brand]}${code}` : '';
          const url = explicitExternal || fallback;
          if (url) window.open(url, '_blank', 'noopener');
        };

        button.addEventListener('click', () => {
          openOffer();
          display.classList.remove('code-fluid-blur', 'select-none');
          display.classList.add('is-revealed');
          navigator.clipboard?.writeText(code).catch(() => {});
          let unlocked = [];
          try { unlocked = JSON.parse(localStorage.getItem(xpStorageKey) || "[]"); } catch (_) { unlocked = []; }
          if (!unlocked.includes(couponId)) {
            unlocked.push(couponId);
            localStorage.setItem(xpStorageKey, JSON.stringify(unlocked));
            if (window.updateScore) window.updateScore(5);
          }
          status.style.opacity = '1';
          setTimeout(() => status.style.opacity = '0', 2500);
        });
      });
    </script>
  {% endif %}
</article>
