<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{ page.title }} | {{ site.title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{{ page.description | default: site.description }}">

    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/media/apple-touch-icon.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ '/media/favicon-32x32.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ '/media/favicon-16x16.png' | relative_url }}">
    <link rel="shortcut icon" href="{{ '/media/favicon.ico' | relative_url }}">
    <meta name="theme-color" content="#0f172a">

    <meta property="og:title" content="{{ page.title }} | {{ site.title }}">
    <meta property="og:description" content="{{ page.description | default: site.description }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ page.url | relative_url | absolute_url }}">
    <meta property="og:image" content="{{ '/media/og-card-1200x630.png' | absolute_url }}">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.title }} | {{ site.title }}">
    <meta name="twitter:description" content="{{ page.description | default: site.description }}">
    <meta name="twitter:image" content="{{ '/media/twitter-card-1200x675.png' | absolute_url }}">

    <!-- Tailwind via CDN for minimal & clean styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        --page-bg: #f8fafc;
        --page-text: #0f172a;
        --surface: #ffffff;
        --muted: #475569;
        --border: #e2e8f0;
        --accent: #0ea5e9;
      }

      body {
        background-color: var(--page-bg);
        color: var(--page-text);
      }

      header,
      footer {
        background-color: var(--surface);
        border-color: var(--border);
      }

      footer {
        color: var(--muted);
      }

      body.dark {
        --page-bg: #020617;
        --page-text: #f8fafc;
        --surface: #050b1c;
        --muted: #cbd5f5;
        --border: #1e293b;
        --accent: #38bdf8;
      }

      #theme-toggle {
        border-color: var(--border);
        color: var(--page-text);
      }

      #theme-toggle-track {
        background-color: var(--border);
      }

      body.dark #theme-toggle-track {
        background-color: #475569;
      }

      #theme-toggle-indicator {
        transform: translateX(0);
      }

      body.dark #theme-toggle-indicator {
        transform: translateX(1.25rem);
      }

      body.dark #theme-toggle {
        border-color: var(--accent);
      }

      [data-surface-card] {
        transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
      }

      body.dark [data-surface-card] {
        background-color: #0b1220;
        border-color: #1f2a3e;
        color: #f8fafc;
      }

      body.dark [data-surface-card] .bg-white {
        background-color: #0f172a;
      }

      body.dark [data-surface-card] .border-slate-200 {
        border-color: #1e293b;
      }

      body.dark [data-surface-card] .text-slate-900,
      body.dark [data-surface-card] .text-slate-800,
      body.dark [data-surface-card] .text-slate-700 {
        color: #f8fafc;
      }

      body.dark [data-surface-card] .text-slate-600,
      body.dark [data-surface-card] .text-slate-500 {
        color: #cbd5f5;
      }

      body.dark [data-surface-card] .text-slate-400 {
        color: #94a3b8;
      }

      body.dark [data-surface-card] .bg-emerald-50 {
        background-color: rgba(16, 185, 129, 0.16);
      }

      body.dark [data-surface-card] .text-emerald-800 {
        color: #86efac;
      }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VDFQXS74CQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-VDFQXS74CQ');
    </script>
  </head>
  <body class="min-h-screen transition-colors duration-300 flex flex-col">
    <header class="border-b">
      <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
        <a href="{{ '/' | relative_url }}" class="text-lg font-semibold tracking-tight flex items-center gap-2">
          <img src="{{ '/media/piggy.png' | relative_url }}" alt="SpendLess'o logo" class="h-8 w-8">
          <span>{{ site.title }}</span>
        </a>
        <nav class="text-sm flex items-center">
          <button id="theme-toggle" type="button" aria-label="Toggle dark mode" class="flex items-center gap-2 rounded-full border px-4 py-2 text-xs font-semibold uppercase tracking-wide transition-colors">
            <span id="theme-toggle-label">Dark mode</span>
            <span id="theme-toggle-track" class="relative inline-flex h-5 w-10 items-center rounded-full transition-colors">
              <span id="theme-toggle-indicator" class="inline-block h-4 w-4 rounded-full bg-white shadow transition-transform"></span>
            </span>
          </button>
        </nav>
      </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8 flex-1 w-full">
      {{ content }}
    </main>

    <footer class="border-t mt-8">
      <div class="max-w-4xl mx-auto px-4 py-6 text-xs">
        &copy; {{ site.time | date: "%Y" }} SpendLesso.com | All discounts fetched from
        <a href="https://reddit.com/r/SpendLess" class="text-slate-900 underline decoration-dotted hover:text-slate-700" target="_blank" rel="noopener">/r/SpendLess</a>
        and updated regularly.
      </div>
    </footer>
    <script>
      (function () {
        const body = document.body;
        const toggleButton = document.getElementById('theme-toggle');
        const toggleLabel = document.getElementById('theme-toggle-label');
        const storageKey = 'spendless-theme';

        if (!toggleButton || !toggleLabel) return;

        const storedTheme = localStorage.getItem(storageKey);
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initialTheme = storedTheme || (prefersDark ? 'dark' : 'light');

        applyTheme(initialTheme);

        toggleButton.addEventListener('click', function () {
          const nextTheme = body.classList.contains('dark') ? 'light' : 'dark';
          applyTheme(nextTheme);
        });

        function applyTheme(theme) {
          const isDark = theme === 'dark';
          body.classList.toggle('dark', isDark);
          localStorage.setItem(storageKey, theme);
          toggleLabel.textContent = isDark ? "Lights off" : "Lights on";
          toggleButton.setAttribute('aria-pressed', isDark);
        }
      })();
    </script>
    <script>
      (function () {
        const storageKey = 'spendless-reported-coupons';
        const reportedLabel = 'Reported, thank you!';
        const defaultLabel = 'Report invalid code';

        const loadReported = () => {
          try {
            const stored = JSON.parse(localStorage.getItem(storageKey) || '[]');
            if (Array.isArray(stored)) {
              return new Set(stored);
            }
          } catch (error) {
            console.warn('Unable to read reported coupons from storage', error);
          }
          return new Set();
        };

        const persistReported = (set) => {
          try {
            localStorage.setItem(storageKey, JSON.stringify(Array.from(set)));
          } catch (error) {
            console.warn('Unable to save reported coupons', error);
          }
        };

        const updateLabel = (element, isReported) => {
          element.textContent = isReported ? reportedLabel : defaultLabel;
          element.setAttribute('aria-pressed', isReported);
          element.classList.toggle('opacity-70', isReported);
        };

        document.addEventListener('DOMContentLoaded', () => {
          const reportButtons = document.querySelectorAll('[data-report-invalid]');
          if (!reportButtons.length) return;

          const reported = loadReported();

          reportButtons.forEach((button) => {
            const couponId = button.getAttribute('data-coupon-id');
            if (!couponId) return;

            const applyState = () => {
              const isReported = reported.has(couponId);
              updateLabel(button, isReported);
            };

            applyState();

            const markReported = () => {
              if (reported.has(couponId)) return;
              reported.add(couponId);
              persistReported(reported);
              updateLabel(button, true);
            };

            button.addEventListener('click', (event) => {
              event.preventDefault();
              event.stopPropagation();
              markReported();
            });

            button.addEventListener('keydown', (event) => {
              if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                event.stopPropagation();
                markReported();
              }
            });
          });
        });
      })();
    </script>
  </body>
</html>
